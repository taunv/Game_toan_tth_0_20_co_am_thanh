<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Ch∆°i v√† H·ªçc To√°n TTH (0‚Äì20)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* T·ªëi ∆∞u h√≥a CSS */
body {
    font-family: 'Comic Sans MS', 'Arial', sans-serif; /* Ph√¥ng ch·ªØ th√¢n thi·ªán */
    background: linear-gradient(135deg, #f0e68c, #add8e6);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    padding: 20px;
}
#game-container {
    background-color: #ffffff;
    border-radius: 30px;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    padding: 30px 40px;
    width: 95%;
    max-width: 550px;
    border: 5px solid #ffb6c1; /* Vi·ªÅn m√†u n·ªïi b·∫≠t */
}
h1 {
    color: #ff69b4;
    font-size: 2.2em;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
}

#controls-top {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-bottom: 20px;
}

/* Ki·ªÉu chung cho t·∫•t c·∫£ c√°c n√∫t v√† select */
select, button {
    font-size: 16px;
    padding: 10px 15px;
    border-radius: 20px;
    border: none;
    font-weight: bold;
    transition: all 0.2s;
}

/* N√∫t B·∫Øt ƒë·∫ßu */
#startButton {
    background: #32cd32; /* Xanh l√° chanh */
    color: white;
    font-size: 1.5em;
    padding: 15px 30px;
    border-radius: 30px;
    box-shadow: 0 5px 0 #1e8449; /* Hi·ªáu ·ª©ng 3D */
}
#startButton:active {
    transform: translateY(3px);
    box-shadow: 0 2px 0 #1e8449;
}

/* N√∫t ƒêi·ªÅu khi·ªÉn tr√™n c√πng */
#levelSelect, #soundBtn {
    flex-grow: 1;
    background: #add8e6; /* Xanh nh·∫°t */
    color: #333;
    box-shadow: 0 3px #89afc3;
}
#levelSelect {
    cursor: pointer;
}

/* ƒê·ªìng h·ªì */
#timer-display {
    font-size: 38px;
    color: #ff4500;
    font-weight: 900;
    margin: 15px 0;
    animation: pulse 1s infinite;
}
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* Khu v·ª±c ph√©p t√≠nh */
#question-area {
    background: #fffacd;
    padding: 25px;
    border-radius: 15px;
    margin: 15px 0;
    border: 3px dashed #ffa07a;
}
#current-question {
    font-size: 48px;
    font-weight: 900;
    color: #333;
    margin: 0;
}

/* L∆∞·ªõi ƒë√°p √°n */
.answer-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-top: 20px;
}
.answer-btn {
    font-size: 28px;
    padding: 20px;
    border-radius: 15px;
    background: #00bfff; /* Xanh da tr·ªùi */
    color: #fff;
    box-shadow: 0 5px 0 #007bb6;
}
.answer-btn:active {
    transform: translateY(3px);
    box-shadow: 0 2px 0 #007bb6;
}
.answer-btn:disabled {
    opacity: 0.6; /* L√†m m·ªù n√∫t ƒë√£ b·∫•m */
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
}

/* Ph·∫£n h·ªìi */
#feedback-area {
    min-height: 50px;
    font-size: 22px;
    font-weight: bold;
    margin-top: 15px;
    padding: 5px;
    color: #2e8b57;
    text-align: center;
}

/* K·∫øt qu·∫£ cu·ªëi c√πng */
.summary-title {
    font-size: 2.5em;
    color: #ff69b4;
    font-weight: 900;
    margin-top: 10px;
    text-align: center;
}
</style>
</head>

<body>
<div id="game-container">
<h1>Ch∆°i v√† H·ªçc To√°n TTH (0‚Äì20)</h1>

<div id="controls-top">
    <select id="levelSelect">
        <option value="easy">D·ªÖ (25s)</option>
        <option value="medium" selected>Trung b√¨nh (20s)</option>
        <option value="hard">Kh√≥ (15s)</option>
    </select>
    <button onclick="toggleSound()" id="soundBtn">üîä √Çm thanh: B·∫¨T</button>
</div>

<button id="startButton" onclick="startGame()">B·∫ÆT ƒê·∫¶U</button>

<div id="game-area" style="display:none">
    <div id="timer-display"></div>

    <div id="question-area">
        <p id="current-question"></p>
    </div>

    <div class="answer-grid" id="answer-grid"></div>

    <div id="feedback-area"></div>
    <div id="progress-display"></div>
</div>
</div>

<script>
/* ===== C·∫§U H√åNH ƒê√É C·∫¨P NH·∫¨T ===== */
const GIOI_HAN = 20;
const SO_BAI = 10;
const THOI_GIAN_LEVEL = {
    easy: 25,     // D·ªÖ: 25 gi√¢y
    medium: 20,   // Trung b√¨nh: 20 gi√¢y
    hard: 15      // Kh√≥: 15 gi√¢y
};

/* ===== BI·∫æN ===== */
let bai=0, dapAn=0, timer, timeLeft;
let score={correct:0,incorrect:0};
let soundOn=true;

/* ===== √ÇM THANH & GI·ªåNG ƒê·ªåC ===== */
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function beep(type){
    if(!soundOn) return;
    let o=audioCtx.createOscillator(),g=audioCtx.createGain();
    o.connect(g); g.connect(audioCtx.destination);
    o.frequency.value=type==="correct"?880:220;
    g.gain.value=.25;
    o.start(); o.stop(audioCtx.currentTime+.3);
}
function speak(text){
    if(!soundOn) return;
    speechSynthesis.cancel();
    let u=new SpeechSynthesisUtterance(text);
    u.lang="vi-VN";
    speechSynthesis.speak(u);
}
function toggleSound(){
    soundOn=!soundOn;
    document.getElementById("soundBtn").innerText=
        soundOn?"üîä √Çm thanh: B·∫¨T":"üîá √Çm thanh: T·∫ÆT";
}

/* ===== S·ªê ‚Üí CH·ªÆ TI·∫æNG VI·ªÜT (0‚Äì20) ===== */
const soChu = [
    "kh√¥ng","m·ªôt","hai","ba","b·ªën","nƒÉm","s√°u","b·∫£y","t√°m","ch√≠n",
    "m∆∞·ªùi","m∆∞·ªùi m·ªôt","m∆∞·ªùi hai","m∆∞·ªùi ba","m∆∞·ªùi b·ªën",
    "m∆∞·ªùi lƒÉm","m∆∞·ªùi s√°u","m∆∞·ªùi b·∫£y","m∆∞·ªùi t√°m","m∆∞·ªùi ch√≠n","hai m∆∞∆°i"
];
function docSo(n){
    return soChu[n] ?? n.toString();
}

/* ===== ƒê·ªåC PH√âP TO√ÅN ===== */
function docPhepToan(text){
    let s = text
        .replace(/\d+/g, m => docSo(parseInt(m)))
        .replace(/\+/g," c·ªông ")
        .replace(/\-/g," tr·ª´ ")
        .replace("="," b·∫±ng m·∫•y");
    speak(s);
}

/* ===== T·∫†O C√ÇU H·ªéI ===== */
function taoCauHoi(){
    let level=document.getElementById("levelSelect").value;
    // S·ªë b∆∞·ªõc ph√©p t√≠nh: D·ªÖ: 1, TB: 2, Kh√≥: 3
    let steps=level==="easy"?1:level==="medium"?2:3; 
    let kq=Math.floor(Math.random()*GIOI_HAN);
    let text=kq.toString();

    for(let i=0;i<steps;i++){
        let op=Math.random()<.5?"+":"-";
        let so=Math.floor(Math.random()*10)+1;
        
        // C·ªë g·∫Øng gi·ªØ ph√©p t√≠nh trong ph·∫°m vi 0-20
        if(op==="+" && kq+so<=GIOI_HAN) {
            kq+=so;
        } else if(op==="-" && kq-so>=0) {
            kq-=so;
        } else{
            // N·∫øu kh√¥ng th·ªÉ gi·ªØ nguy√™n ph√©p t√≠nh, ƒë·∫£o ng∆∞·ª£c:
            if(op==="+"){ // N·∫øu + m√† qu√° 20, chuy·ªÉn sang -
                op="-";
                so=Math.min(so, kq); // Tr·ª´ t·ªëi ƒëa b·∫±ng k·∫øt qu·∫£ hi·ªán t·∫°i
                kq-=so;
            } else { // N·∫øu - m√† ra √¢m, chuy·ªÉn sang +
                op="+";
                so=Math.min(so, GIOI_HAN - kq); // C·ªông t·ªëi ƒëa b·∫±ng 20 - kq
                kq+=so;
            }
        }
        text+=` ${op} ${so}`;
    }
    return{question:text+" = ?",answer:kq};
}
function taoDapAn(d){
    let s=new Set([d]);
    while(s.size<4){
        // T·∫°o c√°c ƒë√°p √°n g√¢y nhi·ªÖu g·∫ßn ƒë√°p √°n ƒë√∫ng (-5 ƒë·∫øn +5)
        let x=d+Math.floor(Math.random()*11)-5; 
        if(x>=0&&x<=GIOI_HAN)s.add(x);
    }
    return[...s].sort(()=>Math.random()-.5);
}

/* ===== TIMER ƒê√É C·∫¨P NH·∫¨T ===== */
function startTimer(){
    clearInterval(timer);
    let level = document.getElementById("levelSelect").value;
    timeLeft = THOI_GIAN_LEVEL[level]; 
    
    updateTimer();
    timer=setInterval(()=>{
        timeLeft--;
        updateTimer();
        if(timeLeft<=0){
            clearInterval(timer);
            beep("wrong");
            speak("H·∫øt gi·ªù");
            showAnswer();
        }
    },1000);
}
function updateTimer(){
    document.getElementById("timer-display").innerText=`‚è≥ ${timeLeft}s`;
}

/* ===== GAME ===== */
function startGame(){
    bai=0; score={correct:0,incorrect:0};
    document.getElementById("startButton").style.display="none";
    document.getElementById("game-area").style.display="block";
    next();
}
function next(){
    if(bai>=SO_BAI) return endGame();
    bai++;
    document.getElementById("feedback-area").innerText="";
    document.getElementById("progress-display").innerText=`B√†i ${bai}/${SO_BAI}`;

    let q=taoCauHoi();
    dapAn=q.answer;
    document.getElementById("current-question").innerText=q.question;
    docPhepToan(q.question);

    let g=document.getElementById("answer-grid");
    g.innerHTML="";
    taoDapAn(dapAn).forEach(v=>{
        let b=document.createElement("button");
        b.className="answer-btn";
        b.innerText=v;
        b.onclick=()=>check(v);
        g.appendChild(b);
    });
    startTimer();
}
function check(v){
    clearInterval(timer);
    
    // ** THAY ƒê·ªîI M·ªöI: V√î HI·ªÜU H√ìA T·∫§T C·∫¢ C√ÅC N√öT ƒê√ÅP √ÅN ƒê·ªÇ CH·ªêNG B·∫§M NHI·ªÄU L·∫¶N **
    document.querySelectorAll('.answer-btn').forEach(btn => btn.disabled = true); 

    if(v===dapAn){
        score.correct++;
        beep("correct"); speak("ƒê√∫ng r·ªìi");
        document.getElementById("feedback-area").innerText="üéâ ƒê√öNG R·ªíI! üéâ";
        setTimeout(next,1500);
    }else{
        score.incorrect++;
        beep("wrong"); speak("Sai r·ªìi");
        showAnswer();
    }
}
function showAnswer(){
    document.getElementById("feedback-area").innerText=
        `‚ùå SAI R·ªíI! ƒê√°p √°n ƒë√∫ng l√† ${dapAn}`;
    setTimeout(next,2000);
}
function endGame(){
    document.getElementById("game-area").innerHTML=`
        <p class="summary-title">ü•≥ HO√ÄN TH√ÄNH!</p>
        <p>‚úÖ ƒê√öNG: ${score.correct} / ${SO_BAI}</p>
        <p>‚ùå SAI: ${score.incorrect} / ${SO_BAI}</p>`;
    let b=document.getElementById("startButton");
    b.innerText="CH∆†I L·∫†I";
    b.style.display="inline-block";
    b.onclick=()=>location.reload();
}
</script>
</body>
</html>
